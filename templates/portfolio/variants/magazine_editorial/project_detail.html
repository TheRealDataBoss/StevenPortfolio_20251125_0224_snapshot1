{% extends base_template|default:"portfolio/base.html" %}
{% load portfolio_tags %}
{% block title %}{{ project.title }} | Portfolio{% endblock %}
{% block content %}
<div data-variant-template="magazine_editorial"></div>

<!-- Article header -->
<header style="background: #faf8f5; border-bottom: 3px double #2c2c2c; padding: 3.5rem 0;">
    <div class="container">
        <div class="col-lg-8 mx-auto">
            {% if project.category %}
            <p class="text-uppercase mb-2" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.7rem; letter-spacing: 0.25em; color: #999;">{{ project.category.name }}</p>
            {% endif %}
            <h1 style="font-family: Georgia, serif; font-size: 2.8rem; font-weight: 700; line-height: 1.15; color: #1a1a1a; margin-bottom: 0.75rem;">{{ project.title }}</h1>
            {% if project.summary %}
            <p style="font-family: Georgia, serif; font-size: 1.15rem; color: #555; font-style: italic; line-height: 1.5;">{{ project.summary }}</p>
            {% endif %}
            <div class="d-flex flex-wrap align-items-center gap-3 mt-3" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.75rem; color: #999; text-transform: uppercase; letter-spacing: 0.1em;">
                {% if project.created_at %}<span>{{ project.created_at|date:"F j, Y" }}</span>{% endif %}
                {% if project.created_at and project.tech_stack %}<span>&middot;</span>{% endif %}
                {% if project.tech_stack %}
                <span>{{ project.tech_stack }}</span>
                {% endif %}
            </div>
        </div>
    </div>
</header>

<!-- Article body -->
<article style="background: #fff; padding: 3rem 0;">
    <div class="container">
        <div class="col-lg-8 mx-auto">
            {% if project.image %}
            <figure style="margin: 0 0 2.5rem 0; border: 1px solid #ddd; padding: 5px; background: #fff;">
                {% responsive_image image=project.image variant="hero" alt=project.title extra_class="img-fluid" %}
            </figure>
            {% endif %}

            <!-- Description with editorial drop-cap on first paragraph -->
            {% if project.description %}
            <div class="editorial-body" style="font-family: Georgia, serif; font-size: 1.05rem; color: #333; line-height: 1.8;">
                {{ project.description|linebreaks }}
            </div>
            <style>
            .editorial-body p:first-of-type::first-letter {
                font-family: Georgia, 'Times New Roman', serif;
                float: left;
                font-size: 4.2rem;
                line-height: 0.85;
                padding-right: 0.12em;
                padding-top: 0.07em;
                font-weight: 700;
                color: #1a1a1a;
            }
            </style>
            {% endif %}

            <!-- Tags -->
            {% if project.tags %}
            <div class="mt-4 mb-3">
                <p class="text-uppercase mb-2" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.65rem; letter-spacing: 0.2em; color: #999;">Tags</p>
                <div class="d-flex flex-wrap gap-2">
                    {% for tag in project.tags|split:"," %}
                    <span class="badge" style="background: #f0ebe3; color: #555; border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.6rem; letter-spacing: 0.08em;">{{ tag }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Tech stack -->
            {% if project.tech_stack %}
            <div class="mt-3 mb-3">
                <p class="text-uppercase mb-2" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.65rem; letter-spacing: 0.2em; color: #999;">Technology</p>
                <div class="d-flex flex-wrap gap-2">
                    {% for tech in project.tech_stack|split:"," %}
                    <span class="badge" style="background: #1a1a1a; color: #faf8f5; border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.6rem; letter-spacing: 0.08em;">{{ tech }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <hr style="border: none; border-top: 3px double #2c2c2c; margin: 2.5rem 0;">

            <!-- Action links -->
            <div class="d-flex flex-wrap gap-3 mb-4">
                {% if project.repo_url %}
                <a href="{{ project.repo_url }}" target="_blank" rel="noopener" class="btn btn-primary" style="border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.8rem;"><i class="fab fa-github me-1"></i> Source Code</a>
                {% endif %}
                {% if project.live_url %}
                <a href="{{ project.live_url }}" target="_blank" rel="noopener" class="btn btn-outline-primary" style="border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.8rem;"><i class="fas fa-external-link-alt me-1"></i> Live Demo</a>
                {% endif %}
            </div>

            <!-- Notes -->
            {% if project.notes %}
            <aside style="border-left: 3px solid #1a1a1a; padding: 1.25rem 1.5rem; background: #faf8f5; margin: 2rem 0;">
                <p class="text-uppercase mb-2" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.65rem; letter-spacing: 0.2em; color: #999;">Editor's Note</p>
                <div style="font-family: Georgia, serif; font-size: 0.95rem; color: #555; line-height: 1.7;">
                    {{ project.notes|linebreaksbr }}
                </div>
            </aside>
            {% endif %}

            <!-- Attachments -->
            {% if visible_attachments %}
            <div class="mt-4">
                <p class="text-uppercase mb-2" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.7rem; letter-spacing: 0.2em; color: #999;">Attachments</p>
                <hr style="border: none; border-top: 1px solid #ddd; margin-bottom: 1.5rem;">
                {% for att in visible_attachments %}
                <div style="border-top: 2px solid #1a1a1a; padding: 1rem 0; margin-bottom: 1.5rem;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong style="font-family: Georgia, serif; font-size: 0.95rem;">{{ att }}</strong>
                        <span class="d-flex gap-2">
                            {% if att.file %}
                                {% if att.is_pdf %}
                                <a href="{% url 'portfolio:project_attachment_preview' att.pk %}" class="btn btn-sm btn-outline-primary" target="_blank" style="border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.08em;"><i class="fas fa-eye me-1"></i>Preview</a>
                                {% endif %}
                                <a href="{% url 'portfolio:project_attachment_download' att.pk %}" class="btn btn-sm btn-outline-primary" style="border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.08em;"><i class="fas fa-download me-1"></i>Download</a>
                            {% elif att.external_url %}
                                <a href="{{ att.external_url }}" class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener" style="border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.08em;"><i class="fas fa-external-link-alt me-1"></i>Open</a>
                            {% endif %}
                        </span>
                    </div>
                    {% if att.file %}
                        {% if att.preview_kind == "pdf" %}
                        <iframe src="{% url 'portfolio:project_attachment_pdf_inline' att.pk %}" class="w-100" style="height:500px; border: 1px solid #ddd;" title="{{ att }}"></iframe>
                        {% elif att.preview_kind == "image" %}
                        <img src="{{ att.file.url }}" class="img-fluid" alt="{{ att }}" style="max-height:500px; border: 1px solid #ddd;">
                        {% elif att.preview_kind == "notebook" %}
                        <iframe src="{% url 'portfolio:project_attachment_notebook_inline' att.pk %}" class="w-100" style="height:500px; border: 1px solid #ddd;" title="{{ att }}"></iframe>
                        {% elif att.preview_kind == "audio" %}
                        <audio controls src="{{ att.file.url }}" class="w-100"></audio>
                        {% elif att.preview_kind == "video" %}
                        <video controls src="{{ att.file.url }}" class="w-100" style="max-height:500px;"></video>
                        {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% elif project.attachment %}
            <div class="mt-4">
                <p class="text-uppercase mb-2" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.7rem; letter-spacing: 0.2em; color: #999;">Attachment</p>
                <hr style="border: none; border-top: 1px solid #ddd; margin-bottom: 1.5rem;">
                <div style="border-top: 2px solid #1a1a1a; padding: 1rem 0;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <strong style="font-family: Georgia, serif; font-size: 0.95rem;">{{ project.attachment.name|cut:"projects/files/" }}</strong>
                        <a href="{% url 'portfolio:legacy_attachment_download' project.pk %}" class="btn btn-sm btn-outline-primary" style="border-radius: 0; font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.08em;"><i class="fas fa-download me-1"></i>Download</a>
                    </div>
                    {% if legacy_preview_kind == "pdf" %}
                    <iframe src="{% url 'portfolio:legacy_attachment_inline' project.pk %}" class="w-100" style="height:500px; border: 1px solid #ddd;" title="Attachment"></iframe>
                    {% elif legacy_preview_kind == "image" %}
                    <img src="{{ project.attachment.url }}" class="img-fluid" alt="Attachment" style="max-height:500px; border: 1px solid #ddd;">
                    {% elif legacy_preview_kind == "notebook" %}
                    <iframe src="{% url 'portfolio:legacy_attachment_inline' project.pk %}" class="w-100" style="height:500px; border: 1px solid #ddd;" title="Attachment"></iframe>
                    {% elif legacy_preview_kind == "audio" %}
                    <audio controls src="{{ project.attachment.url }}" class="w-100"></audio>
                    {% elif legacy_preview_kind == "video" %}
                    <video controls src="{{ project.attachment.url }}" class="w-100" style="max-height:500px;"></video>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Project meta colophon -->
            <div style="border-top: 3px double #2c2c2c; margin-top: 2.5rem; padding-top: 1.5rem;">
                <p class="text-uppercase mb-3" style="font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.7rem; letter-spacing: 0.2em; color: #999;">Colophon</p>
                <div class="row g-3" style="font-family: Georgia, serif; font-size: 0.9rem; color: #555;">
                    <div class="col-sm-6">
                        <p class="mb-1"><span style="font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.15em; color: #999;">Category</span><br>{{ project.category.name }}</p>
                    </div>
                    {% if project.tech_stack %}
                    <div class="col-sm-6">
                        <p class="mb-1"><span style="font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.15em; color: #999;">Tech Stack</span><br>{{ project.tech_stack }}</p>
                    </div>
                    {% endif %}
                    <div class="col-sm-6">
                        <p class="mb-1"><span style="font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.15em; color: #999;">Created</span><br>{{ project.created_at|date:"F j, Y" }}</p>
                    </div>
                    <div class="col-sm-6">
                        <p class="mb-0"><span style="font-family: 'Helvetica Neue', Arial, sans-serif; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.15em; color: #999;">Updated</span><br>{{ project.updated_at|date:"F j, Y" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</article>
{% endblock %}
